package com.xyhui.activity.weibo;

import android.view.View;
import android.view.View.OnClickListener;
import android.widget.Button;

import com.handmark.pulltorefresh.library.PullToRefreshListView;
import com.xyhui.R;
import com.xyhui.utils.Params;
import com.xyhui.widget.FLActivity;

public class MessageActivity extends FLActivity {
	private Button btn_back;

	private Button btn_message;
	private Button btn_atme;
	private Button btn_comments;
	private Button current_btn;

	private PullToRefreshListView message_listview;
	private PullToRefreshListView atme_listview;
	private PullToRefreshListView comments_listview;
	private PullToRefreshListView current_listview;

	private ChatList mMessageListView;
	private WeiboList mWeiboListView;
	private CommentList mCommentsListView;

	private int msg_type = Params.INTENT_VALUE.MSG_MESSAGE;

	@Override
	public void init() {
		if (getIntent().hasExtra(Params.INTENT_EXTRA.MSG_TYPE)) {
			msg_type = getIntent().getIntExtra(Params.INTENT_EXTRA.MSG_TYPE,
					Params.INTENT_VALUE.MSG_MESSAGE);
		}
	}

	@Override
	public void linkUiVar() {
		setContentView(R.layout.activity_message);

		btn_back = (Button) findViewById(R.id.btn_back);

		btn_message = (Button) findViewById(R.id.btn_message);
		btn_atme = (Button) findViewById(R.id.btn_atme);
		btn_comments = (Button) findViewById(R.id.btn_comments);

		message_listview = (PullToRefreshListView) findViewById(R.id.message_listview);
		atme_listview = (PullToRefreshListView) findViewById(R.id.atme_listview);
		comments_listview = (PullToRefreshListView) findViewById(R.id.comments_listview);
	}

	@Override
	public void bindListener() {
		btn_back.setOnClickListener(new OnClickListener() {
			@Override
			public void onClick(View v) {
				// 关闭返回
				finish();
			}
		});

		btn_message.setOnClickListener(new OnClickListener() {
			@Override
			public void onClick(View v) {
				if (current_btn != btn_message) {
					msg_type = Params.INTENT_VALUE.MSG_MESSAGE;
					selectMsgByType();
				}
			}
		});

		btn_atme.setOnClickListener(new OnClickListener() {
			@Override
			public void onClick(View v) {
				if (current_btn != btn_atme) {
					msg_type = Params.INTENT_VALUE.MSG_ATME;
					selectMsgByType();
				}
			}
		});

		btn_comments.setOnClickListener(new OnClickListener() {
			@Override
			public void onClick(View v) {
				if (current_btn != btn_comments) {
					msg_type = Params.INTENT_VALUE.MSG_COMMENTS;
					selectMsgByType();
				}
			}
		});
	}

	@Override
	public void ensureUi() {
		message_listview.setVisibility(View.GONE);
		atme_listview.setVisibility(View.GONE);
		comments_listview.setVisibility(View.GONE);
		selectMsgByType();
	}

	public void selectMsgByType() {

		if (current_btn != null) {
			current_btn.setSelected(false);
		}

		if (current_listview != null) {
			current_listview.setVisibility(View.GONE);
		}

		switch (msg_type) {
		case Params.INTENT_VALUE.MSG_MESSAGE:
			if (mMessageListView == null) {
				mMessageListView = new ChatList(message_listview, mActivity);
			} else {
				mMessageListView.refreshListViewStart();
			}
			current_btn = btn_message;
			current_listview = message_listview;
			break;
		case Params.INTENT_VALUE.MSG_ATME:
			if (mWeiboListView == null) {
				mWeiboListView = new WeiboList(atme_listview, mActivity, WeiboList.METIONS);
			} else {
				mWeiboListView.refreshListViewStart();
			}
			current_btn = btn_atme;
			current_listview = atme_listview;
			break;
		case Params.INTENT_VALUE.MSG_COMMENTS:
			if (mCommentsListView == null) {
				mCommentsListView = new CommentList(comments_listview, mActivity);
			} else {
				mCommentsListView.refreshListViewStart();
			}
			current_btn = btn_comments;
			current_listview = comments_listview;
			break;
		default:
			break;
		}

		current_btn.setSelected(true);
		current_listview.setVisibility(View.VISIBLE);
	}

	@Override
	protected void onResume() {
		super.onResume();
		switch (msg_type) {
		case Params.INTENT_VALUE.MSG_MESSAGE:
			mMessageListView.refreshListViewStart();
			break;
		case Params.INTENT_VALUE.MSG_ATME:
			mWeiboListView.refreshListViewStart();
			break;
		case Params.INTENT_VALUE.MSG_COMMENTS:
			mCommentsListView.refreshListViewStart();
			break;
		}
	}
}
