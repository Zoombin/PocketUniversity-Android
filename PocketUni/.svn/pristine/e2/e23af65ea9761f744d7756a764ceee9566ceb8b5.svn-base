package com.xyhui.activity;

import android.app.AlertDialog;
import android.content.ActivityNotFoundException;
import android.content.DialogInterface;
import android.content.Intent;
import android.os.Bundle;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.ImageButton;
import android.widget.TextView;

import com.xyhui.R;
import com.xyhui.activity.app.ChargeActivity;
import com.xyhui.activity.app.CourseListActivity;
import com.xyhui.activity.app.GameCenterActivity;
import com.xyhui.activity.app.MobileZoneListActivity;
import com.xyhui.activity.app.NoticeListActivity;
import com.xyhui.activity.app.ShakeActivity;
import com.xyhui.activity.app.WishHelpActivity;
import com.xyhui.activity.event.EventListActivity;
import com.xyhui.activity.group.GroupListActivity;
import com.xyhui.types.MobileApp;
import com.xyhui.utils.DownloadImpl;
import com.xyhui.utils.Params;
import com.xyhui.widget.FLTabActivity;

public class Tab3AppActivity extends FLTabActivity {

	ImageButton btn_message;
	ImageButton btn_activity;
	ImageButton btn_group;
	ImageButton btn_expense;
	ImageButton btn_job;
	ImageButton btn_travel;
	ImageButton btn_volunteer;
	ImageButton btn_course;
	ImageButton btn_mobileZone;
	ImageButton btn_shake;
	ImageButton btn_wishhelp;
	ImageButton btn_app_gamecenter;
	ImageButton btn_app_charge;

	TextView txt_volunteer;
	TextView txt_operator_zone;

	@Override
	public void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_tab_app);

		linkUiVar();
		bindListener();
		ensureUi();
	}

	@Override
	public void linkUiVar() {
		btn_message = (ImageButton) findViewById(R.id.btn_app_xntz);
		btn_activity = (ImageButton) findViewById(R.id.btn_app_xyhd);
		btn_group = (ImageButton) findViewById(R.id.btn_app_st);
		btn_expense = (ImageButton) findViewById(R.id.btn_app_xf);
		btn_job = (ImageButton) findViewById(R.id.btn_app_zp);
		btn_travel = (ImageButton) findViewById(R.id.btn_app_ly);
		btn_volunteer = (ImageButton) findViewById(R.id.btn_app_volunteer);
		btn_course = (ImageButton) findViewById(R.id.btn_course);
		btn_mobileZone = (ImageButton) findViewById(R.id.btn_mobilezone);
		btn_shake = (ImageButton) findViewById(R.id.btn_shake);
		btn_wishhelp = (ImageButton) findViewById(R.id.btn_wishhelp);
		btn_app_gamecenter = (ImageButton) findViewById(R.id.btn_app_gamecenter);
		btn_app_charge = (ImageButton) findViewById(R.id.btn_app_charge);

		txt_volunteer = (TextView) findViewById(R.id.txt_app_volunteer);
		txt_operator_zone = (TextView) findViewById(R.id.text_operator_zone);
	}

	@Override
	public void bindListener() {

		btn_message.setOnClickListener(new OnClickListener() {
			@Override
			public void onClick(View v) {
				// 打开校内通知
				Intent intent = new Intent();
				intent.setClass(mActivity, NoticeListActivity.class);
				mActivity.startActivity(intent);
			}
		});

		btn_activity.setOnClickListener(new OnClickListener() {
			@Override
			public void onClick(View v) {
				// 打开校园活动
				Intent intent = new Intent();
				intent.setClass(mActivity, EventListActivity.class);
				mActivity.startActivity(intent);
			}
		});

		btn_group.setOnClickListener(new OnClickListener() {
			@Override
			public void onClick(View v) {
				// 打开部落
				Intent intent = new Intent();
				intent.setClass(mActivity, GroupListActivity.class);
				mActivity.startActivity(intent);
			}
		});

		btn_expense.setOnClickListener(new OnClickListener() {
			@Override
			public void onClick(View v) {
				// 打开消费
				Intent intent = new Intent();
				intent.setClass(mActivity, WebViewActivity.class);
				intent.putExtra(Params.INTENT_EXTRA.WEBVIEW_TITLE, "消费");
				mActivity.startActivity(intent);
			}
		});

		btn_job.setOnClickListener(new OnClickListener() {
			@Override
			public void onClick(View v) {
				// 打开招聘
				Intent intent = new Intent();
				intent.setClass(mActivity, WebViewActivity.class);
				intent.putExtra(Params.INTENT_EXTRA.WEBVIEW_TITLE, "招聘");
				mActivity.startActivity(intent);
			}
		});

		btn_travel.setOnClickListener(new OnClickListener() {
			@Override
			public void onClick(View v) {
				// 打开旅游
				Intent intent = new Intent();
				intent.setClass(mActivity, WebViewActivity.class);
				intent.putExtra(Params.INTENT_EXTRA.WEBVIEW_TITLE, "旅游");
				mActivity.startActivity(intent);
			}
		});

		btn_volunteer.setOnClickListener(new OnClickListener() {
			@Override
			public void onClick(View v) {
				final MobileApp app = new MobileApp("志愿者打卡器", null, R.drawable.app_icon_volunteer,
						"http://pu.dakaqi.cn/apk/pu_volunteer.apk", "com.lifeyoyo.volunteer.pu");

				// 打开志愿者打卡器
				if (PuApp.get().isInstalled(app)) {
					launchApp(app);
				} else {
					new AlertDialog.Builder(mActivity).setTitle("下载").setMessage("点击确定开始下载")
							.setPositiveButton("确定", new DialogInterface.OnClickListener() {
								public void onClick(DialogInterface dialog, int whichButton) {
									downloadApp(app);
								}
							}).setNeutralButton("取消", new DialogInterface.OnClickListener() {
								public void onClick(DialogInterface dialog, int whichButton) {

								}
							}).setCancelable(false).show();
				}
			}
		});

		btn_course.setOnClickListener(new OnClickListener() {
			@Override
			public void onClick(View v) {
				// 打开课程
				Intent intent = new Intent();
				intent.setClass(mActivity, CourseListActivity.class);
				mActivity.startActivity(intent);
			}
		});

		btn_mobileZone.setOnClickListener(new OnClickListener() {
			@Override
			public void onClick(View v) {
				// 打开运营商专区
				Intent intent = new Intent();
				intent.setClass(mActivity, MobileZoneListActivity.class);
				mActivity.startActivity(intent);
			}
		});

		btn_shake.setOnClickListener(new OnClickListener() {
			@Override
			public void onClick(View v) {
				// 打开摇一摇
				Intent intent = new Intent();
				intent.setClass(mActivity, ShakeActivity.class);
				mActivity.startActivity(intent);
			}
		});

		btn_wishhelp.setOnClickListener(new OnClickListener() {
			@Override
			public void onClick(View v) {
				// 打开许愿,求助
				Intent intent = new Intent();
				intent.setClass(mActivity, WishHelpActivity.class);
				mActivity.startActivity(intent);
			}
		});

		btn_app_gamecenter.setOnClickListener(new OnClickListener() {
			@Override
			public void onClick(View v) {
				// 打开游戏中心
				Intent intent = new Intent();
				intent.setClass(mActivity, GameCenterActivity.class);
				mActivity.startActivity(intent);
			}
		});

		btn_app_charge.setOnClickListener(new OnClickListener() {
			@Override
			public void onClick(View v) {
				// 打开冲值
				Intent intent = new Intent();
				intent.setClass(mActivity, ChargeActivity.class);
				mActivity.startActivity(intent);
			}
		});
	}

	@Override
	public void ensureUi() {
		txt_volunteer.setText("志愿者打卡器");
		txt_volunteer.setSelected(true);

		txt_operator_zone.setText("运营商专区");
		txt_operator_zone.setSelected(true);
	}

	private void launchApp(MobileApp app) {
		String packageName = app.mPkgName;
		Intent mIntent = mContext.getPackageManager().getLaunchIntentForPackage(packageName);

		if (mIntent != null) {
			try {
				mContext.startActivity(mIntent);
			} catch (ActivityNotFoundException err) {

			}
		}
	}

	private void downloadApp(MobileApp app) {
		String appName = app.mAppName;
		String filename = appName + ".apk";

		DownloadImpl download = new DownloadImpl(mContext, app.mDownloadUrl, appName, filename);
		download.startDownload();
	}
}
