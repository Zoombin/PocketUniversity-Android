package com.xyhui.activity;

import android.graphics.Bitmap;
import android.os.Bundle;
import android.util.DisplayMetrics;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.ImageView;
import android.widget.RelativeLayout;

import com.koushikdutta.urlimageviewhelper.UrlImageViewCallback;
import com.koushikdutta.urlimageviewhelper.UrlImageViewHelper;
import com.mslibs.utils.VolleyLog;
import com.xyhui.R;
import com.xyhui.utils.Preferences;
import com.xyhui.widget.FLActivity;

public class ImageViewActivity extends FLActivity {

	private ImageView img_imageview;

	String url = null;

	DisplayMetrics metrics;
	RelativeLayout layout_bg;

	@Override
	public void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_imageview);

		if (getIntent().hasExtra(Preferences.INTENT_EXTRA.URL)) {
			url = getIntent().getStringExtra(Preferences.INTENT_EXTRA.URL);
		} else {
			finish();
			return;
		}

		linkUiVar();
		bindListener();
		ensureUi();
	}

	@Override
	public void linkUiVar() {
		img_imageview = (ImageView) findViewById(R.id.img_imageview);

		layout_bg = (RelativeLayout) findViewById(R.id.layout_bg);
	}

	@Override
	public void bindListener() {

		layout_bg.setOnClickListener(new OnClickListener() {
			@Override
			public void onClick(View v) {
				finish();
			}
		});

		img_imageview.setOnClickListener(new OnClickListener() {
			@Override
			public void onClick(View v) {
				finish();
			}
		});
	}

	@Override
	public void ensureUi() {
		// gets screen dimensions
		metrics = new DisplayMetrics();
		getWindowManager().getDefaultDisplay().getMetrics(metrics);

		VolleyLog.d("url: %s", url);
		VolleyLog.d("before: %d", img_imageview.getLayoutParams().width);
		UrlImageViewHelper.setUrlDrawable(img_imageview, url, R.drawable.img_default,
				UrlImageViewHelper.CACHE_DURATION_THREE_DAYS, callback);
	}

	UrlImageViewCallback callback = new UrlImageViewCallback() {
		@Override
		public void onLoaded(ImageView arg0, Bitmap arg1, String arg2, boolean arg3) {

		}

	};
}
