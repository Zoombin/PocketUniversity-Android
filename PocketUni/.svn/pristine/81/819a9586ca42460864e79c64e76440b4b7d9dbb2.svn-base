package com.xyhui.widget;

import android.content.Context;
import android.content.Intent;
import android.text.TextUtils;
import android.view.View;
import android.widget.ImageView;
import android.widget.TextView;

import com.koushikdutta.urlimageviewhelper.UrlImageViewHelper;
import com.mslibs.utils.VolleyLog;
import com.mslibs.widget.CPagerItem;
import com.xyhui.R;
import com.xyhui.activity.event.EventViewActivity;
import com.xyhui.api.Client;
import com.xyhui.types.EventBanner;
import com.xyhui.utils.Params;

public class BannerPagerItem extends CPagerItem {
	private Object data;
	private ImageView banner_img;
	private TextView banner_title;

	public BannerPagerItem(Context context) {
		super(context);

		setContentView(R.layout.widget_banner_item);
		linkUiVar();
	}

	public void linkUiVar() {
		banner_img = (ImageView) findViewById(R.id.banner_img);
		banner_title = (TextView) findViewById(R.id.banner_title);
	}

	public void bindListener() {
		banner_img.setOnClickListener(new OnClickListener() {
			@Override
			public void onClick(View v) {
				EventBanner item = (EventBanner) data;

				Intent intent = new Intent();
				intent.setClass(getContext(), EventViewActivity.class);
				intent.putExtra(Params.INTENT_EXTRA.EVENTID, item.id);
				getContext().startActivity(intent);
			}
		});
	}

	public void reload(Object d) {
		data = d;
		ensureUi();
	}

	public void ensureUi() {
		EventBanner item = (EventBanner) data;
		if (!TextUtils.isEmpty(item.banner)) {
			String img = Client.BANNER_URL_PREFIX + item.banner;
			VolleyLog.d("img=%s", img);

			UrlImageViewHelper.setUrlDrawable(banner_img, img, R.drawable.img_default);
		} else {
			banner_img.setImageResource(R.drawable.none);
		}

		banner_title.setText(item.title);
		bindListener();
	}
}
